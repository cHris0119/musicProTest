<!DOCTYPE html>
<html lang="en">
{% load static %}

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Productos</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <style type="text/css">
        BODY {
            font-family: verdana;
        }
    </style>
    <link rel="stylesheet" href="{% static 'music_pro/main.css' %}">
</head>

<body>
    <!--HEADER-->
    <header>
        <a href="{% url 'inicio' %}" class="logo">
            <img src="{% static 'music_pro/img/musicprologo.png' %}">
            <h2>MusicPro</h2>
        </a>
        <nav>
            <a href="{% url 'inicio' %}" class="nav-link">Inicio</a>
            <a href="{% url 'productos' %}" class="nav-link">Tienda</a>
            <a href="" class="nav-link">Cerrar sesion</a>
            <a href="{% url 'carrito' user.username %}" class="nav-link"><img src="{% static 'music_pro/img/carrito.png' %}"></a>
        </nav>

    </header>
    <!--FIN HEADER-->

    <div class="container-prod">
        <div>
            <div class="encabezado-inicio">
                <h2>Productos</h2>
            </div>

            
            <div id="divBody" class='flex-container'>
                
            </div>



        </div>

    </div>
    <footer class="footer">
        <div>
            <p>@LaCabraDoradaCompany</p>
        </div>
    </footer>

    <script>
        $(document).ready(function () {
            BindStudents();
        });

        function BindStudents() {
            $.ajax({
                type: 'GET',
                dataType: 'json',
                url: "http://127.0.0.1:8000/api_VentaBodega/Productos", success: function (result) {

                    var totalCount = result.length;
                    var structureDiv = "";
                    var st = "";
                    for (let i = 0; i < totalCount; i++) {
                        stock(result[i].idProd)
                        num = result[i].precio
                        structureDiv +=
                            "<form action='{% url 'agregarcarrito' %}' method='GET'>"+
                            "<div class='flex-item'>" +
                            "<img class='flex-item__img' src='" + result[i].img + "'>" +
                            "<h3>" + result[i].nombre + "</h3>" +
                            "<div id='" + result[i].idProd + "'></div>" +
                            "<h4>" + result[i].precio + "</h4>" +
                            "<input type='hidden' value='"+ result[i].precio +"' type='number' id='precio' name='precio' />"+
                            "<input type='hidden' value='"+ result[i].idProd +"' type='number' id='id_pro' name='id_pro' />"+
                            "<input type='hidden' value='{{ user.username }}' type='text' id='usuario' name='usuario' />"+
                            "<input  value='1' min='1' type='number' id='cantidad' name='cantidad' />"+
                            "<button type=submit> Agregar al carrito </button>"+
                            "</div>"+
                            "</form>"

                    }

                    $("#divBody").html(structureDiv);

                }
            });

        }

        function stock(id) {
            $.ajax({
                type: 'GET',
                dataType: 'json',
                url: "http://127.0.0.1:8000/api_VentaBodega/Producto/" + id + "", success: function (result) {

                var structureDiv = "";
                structureDiv =
                    "<h3> Stock Disponible: " + result.stock + "</h3>"
                console.log(result)
                $("#" + id).html(structureDiv);
            }
        });

        }
    </script>
</body>



</html>